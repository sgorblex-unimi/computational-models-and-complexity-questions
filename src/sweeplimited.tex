\chapter{Sweeping limited automata}



\section{Crossing sequences}


\subsection{Matching crossing sequences}
% It can technically hold for any LBA
\begin{defn}
	Given a $k$-DLA $A:=(Q,\Sigma,\Gamma,\delta,q_I,F)$, we define left- and right-matching pairs of crossing sequences with respect to a symbol $\sigma\in\Gamma$ as follows:
	\begin{rules}
		\item \label{itm:crossmatchswepDLA-1} The empty sequence $[~]$ right-matches and left-matches itself with respect to~$\sigma$.
		\item \label{itm:crossmatchswepDLA-2} If $[q_3,\dots,q_h]$ right-matches $[p_1,\dots,p_l]$ with respect to~$\sigma'$ and $\delta(q_1,\sigma)=(q_2,\sigma',\tl)$, then $[q_1,\dots,q_h]$ right-matches $[p_1,\dots,p_l]$ with respect to~$\sigma$.
		The computation enters the cell from the left in state $q_1$, turns around right away leaving it to the left in $q_2$ writing $\sigma$, and eventually comes back to it in $q_3$, to which we apply induction.
		\item \label{itm:crossmatchswepDLA-3} If $[q_2,\dots,q_h]$ left-matches $[p_2,\dots,p_l]$ with respect to~$\sigma'$ and $\delta(q_1,\sigma)=(p_1,\sigma',\tr)$, then $[q_1,\dots,q_h]$ right-matches $[p_1,\dots,p_l]$ with respect to~$\sigma$.
		The computation enters the cell from the right in state $p_1$, immediately leaves it to the left in $q_1$ writing $\sigma$, and eventually comes back to it in $q_2$, to which we apply induction.
		\item \label{itm:crossmatchswepDLA-4} Similarly to \Cref{itm:crossmatchswepDLA-2}, if $[q_1,\dots,q_h]$ left-matches $[p_3,\dots,p_l]$ with respect to~$\sigma'$ and $\delta(p_1,\sigma)=(p_2,\sigma',\tr)$, then $[q_1,\dots,q_h]$ left-matches $[p_1,\dots,p_l]$ with respect to~$\sigma$.
		\item \label{itm:crossmatchswepDLA-5} Similarly to \Cref{itm:crossmatchswepDLA-3}, if $[q_2,\dots,q_h]$ right-matches $[p_2,\dots,p_l]$ with respect to~$\sigma'$ and $\delta(p_1,\sigma)=(q_1,\sigma',\tl)$, then $[q_1,\dots,q_h]$ left-matches $[p_1,\dots,p_l]$ with respect to~$\sigma$.
	\end{rules}
\end{defn}

% As for previous, it can technically hold for any LBA
\begin{defn}
	Given a $k$-DLA, we define the partial function $\last:\crosseqset\times\crosseqset\times\Gamma\to\Gamma$ as follows:

	Given crossing sequences $c=[q_1,\dots,q_h]$ and $d=[p_1,\dots,p_l]$ and a symbol $\sigma\in\Gamma$:
	\begin{itemize}
		\item If $c$ right-matches $d$ with respect to $\sigma$ via \Cref{itm:crossmatchswepDLA-2}, then $\delta(q_1,\sigma)=(q_2,\sigma',\tl)$ for some $\sigma'$, and we define:
		      \begin{equation*}
			      \last(c,d,\sigma):=\begin{cases}
				      \sigma'                                        & \text{if } c=[q_1,q_2]\land d=[~], \\
				      \last([q_3,\dots,q_h],[p_1,\dots,p_l],\sigma') & \text{otherwise}.
				      % \last([q_3,\dots,q_h],d,\sigma') & \text{otherwise}.
			      \end{cases}
		      \end{equation*}
		\item If $c$ right-matches $d$ with respect to $\sigma$ via \Cref{itm:crossmatchswepDLA-3}, then $\delta(q_1,\sigma)=(p_1,\sigma',\tr)$ for some $\sigma'$, and we define:
		      \begin{equation*}
			      \last(c,d,\sigma):=\begin{cases}
				      \sigma'                                        & \text{if } c=[q_1]\land d=[p_1],~~ \\
				      \last([q_2,\dots,q_h],[p_2,\dots,p_l],\sigma') & \text{otherwise}.
			      \end{cases}
		      \end{equation*}
		\item If $c$ left-matches $d$ with respect to $\sigma$ via \Cref{itm:crossmatchswepDLA-4}, then $\delta(p_1,\sigma)=(p_2,\sigma',\tr)$ for some $\sigma'$, and we define:
		      \begin{equation*}
			      \last(c,d,\sigma):=\begin{cases}
				      \sigma'                                        & \text{if } c=[~]\land d=[p_1,p_2], \\
				      \last([q_1,\dots,q_h],[p_3,\dots,p_l],\sigma') & \text{otherwise}.
				      % \last(c,[p_3,\dots,p_l],\sigma') & \text{otherwise}.
			      \end{cases}
		      \end{equation*}
		\item If $c$ left-matches $d$ with respect to $\sigma$ via \Cref{itm:crossmatchswepDLA-5}, then $\delta(p_1,\sigma)=(q_1,\sigma',\tl)$ for some $\sigma'$, and we define:
		      \begin{equation*}
			      \last(c,d,\sigma):=\begin{cases}
				      \sigma'                                        & \text{if } c=[q_1]\land d=[p_1],~~ \\
				      \last([q_2,\dots,q_h],[p_2,\dots,p_l],\sigma') & \text{otherwise}.
			      \end{cases}
		      \end{equation*}
	\end{itemize}
\end{defn}


\subsection{Equivalent sweeping \texorpdfstring{$k$}{k}-DLAs}
% NOTE: an easier version would be to turn the bit to 1 (and analogue changes) when READING some symbol from Gamma_k. That would ensure k+1 sweeps are performed
\begin{thrm}
	Let $k$ a natural number and $k':=2\ceil{\frac{k}{2}}$ (namely the smallest even number greater or equal to $k$).
	Every sweeping $k$-DLA with $n$ states can be converted into an equivalent sweeping $k$-DLA with $2n+3$ states and the same working alphabet that performs at least $k'+1$ sweeps on each accepting computation.
\end{thrm}
\begin{proof}
	\newcommand{\ql}{q_{1\mathtt{L}}}
	\newcommand{\qr}{q_{1\mathtt{R}}}

	Let $A:=(Q,\Sigma,\Gamma,\delta,q_I,F)$ a sweeping $k$-DLA.
	Define the sweeping $k$-DLA $A':=(Q',\Sigma,\Gamma,\delta',q'_I,F')$, where
	\begin{itemize}
		\item $Q'=(Q\times\set{0,1})\cup\set{q_0,\ql,\qr}$,
		\item $q'_I:=(q_I,0)$,
		\item $F':=(F\times\set{1})\cup\set{\qr}$.
	\end{itemize}

	The automaton $A'$ starts by simulating $A$ using the first component of the states in $Q\times\set{0,1}$, while the second component is a bit which remembers whether a symbol from $\Gamma_k$ has ever been written.
	The automaton proceeds like this until $A$ would accept.
	% TODO: fix sentence. Not logically clear
	That is, for each $q\in Q$ and $\sigma\in\Gamma$ such that $\delta(q,\sigma)=(q',\sigma',d)$ or $\sigma=\rem$ and $d=\tl$:
	\begin{equation*}
		\delta'((q,0),\sigma):=\begin{cases}
			((q',1),\sigma',d) \qquad & \text{if }\sigma'\in\Gamma_k \\
			((q',0),\sigma',d) \qquad & \text{otherwise}
		\end{cases}
	\end{equation*}
	and:
	\begin{equation*}
		\delta'((q,1),\sigma):=((q',1),\sigma',d)
	\end{equation*}

	When $A$ would accept (by surpassing the right end-marker in a final state), different cases occur:
	\begin{enumerate}
		\item If a symbol in $\Gamma_k$ was never written (i.e. the stored bit is set to $0$), the desired number of sweeps has certainly not been reached, therefore $A'$ enters the special state $q_0$, which has the task to perform the remaining sweeps (see below for details).
		\item If a symbol in $\Gamma_k$ has been written, the automaton has performed at least $k$ sweeps. In particular:
		      \begin{enumerate}
			      \item If $k$ is even, the $k$-th sweep was performed towards the left, thus, since the right end-marker has been reached, at least $k+1=k'+1$ sweeps have been performed. Thus, $A'$ can surpass $\rem$ and accept.
			      \item If $k$ is odd, it might be the case that exactly $k$ sweeps have been performed. The special states $\ql$ and $\qr$ are entered in order to perform two final sweeps ($\ql$ towards the left and $\qr$ towards the right) and accept.
		      \end{enumerate}
	\end{enumerate}

	Formally, if $\delta(q,\rem)=(q_f,\rem,\tr)$ (with $q_f$ final):
	\begin{equation*}
		\delta'((q,0),\rem):=(q_0,\rem,\tl) \text,
	\end{equation*}
	\begin{equation*}
		\delta'((q,1),\rem):=\begin{cases}
			((q_f,1),\rem,\tr) \qquad & \text{if $k$ is even}      \\
			(\ql,\rem,\tl) \qquad     & \text{if otherwise} \text;
		\end{cases}
	\end{equation*}
	and, for any $\sigma\in\Gamma$:
	\begin{align*}
		\delta'(\ql,\sigma) & :=(\ql,\sigma,\tl) \\
		\delta'(\ql,\lem)   & :=(\qr,\lem,\tr)   \\
		\delta'(\qr,\sigma) & :=(\qr,\sigma,\tr) \\
		\delta'(\qr,\rem)   & :=(\qr,\rem,\tr)
	\end{align*}

	% TODO: finish proof
\end{proof}


\subsection{Active crossing sequences}
% TODO: definition of "active" crossing sequence (fixed length ~k)
\dots


\section{Simulation by NFA}
Let $A:=(Q,\Sigma,\Gamma,\delta,q_I,F)$ a sweeping $k$-DLA.
Let $\crosseqset$ the set of its active crossing sequences, $\transtabset$ is the set of its transition tables, and $\RM\subseteq(\crosseqset\times\crosseqset\times\Gamma\times\Gamma)$ the relation of its right-matching crossing sequences.

Define the NFA $A':=(Q',\Sigma',\delta',I,F')$, where
\begin{itemize}
	\item $Q'=\mathcal C\times\mathcal T\times Q$,
	\item $\Sigma'=\Sigma\cup\set{\lem,\rem}$,
	\item $\delta'((c,\tau,r),\sigma):=\set{(d,\pi,s) \mid \text{$d$ is right-matched by $c$ w.r.t. $\sigma$ and,}\\
			      \text{\hspace{8em}defined $\sigma':=\last(c,d,\sigma)$,\quad$\pi=\trapp_{\sigma'}(\tau)$ and $s=\pi(r)$}}$,
	\item $I:=\set{(c,\tau_\emptyword,r) \mid \text{$c=[q_1,\dots,r]$ is right-matched by $[q_I]$ w.r.t. $\lem$}}$, and
	\item $F':=\set{(c,\tau,s)\mid s\in F}$.
\end{itemize}
